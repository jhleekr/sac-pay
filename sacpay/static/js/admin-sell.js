var t=[],e=0;function n(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),i=0;i<n.length;i++){for(var s=n[i];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(e))return s.substring(e.length,s.length)}return""}function i(){"black"==document.getElementById("qr").style.backgroundColor?document.getElementById("qr").style.background="transparent":document.getElementById("qr").style.backgroundColor="black"}function s(t){document.getElementById("console").innerHTML="CONSOLE// "+t}function d(t){document.getElementById("output").innerHTML="OUTPUT// "+t}function r(t){document.getElementById("status").innerHTML="STATUS// "+t}var o=n("-sp-admin-session");function c(){d("BUSY"),m(t),d("STANDBY")}function m(t){let e=[];for(const n of t)e.push(`\n        <div id="order-i-${n.id}" class="order-i">\n            <div class="lbox">\n                <div class="stxt">${n.mname}</div>\n                <div class="stxt">${n.mprice} ƕ</div>\n            </div>\n            <div class="rbox">\n                <div class="pm" onclick="v(${n.id})">-</div>\n                <div class="txt">${n.mcnt}</div>\n                <div class="pm" onclick="f(${n.id})">+</div>\n            </div>\n        </div>\n        `);document.getElementById("order").innerHTML=e.join("")}function u(){var e=0;for(const n of t)e+=n.mprice*n.mcnt;document.getElementById("amnt").innerText=e+" ƕ"}function l(n,i){if(!(e>0)){i=parseInt(i);for(const e of t)if(e.mname==n)return void f(e.id);t.push({id:t.length+1,mname:n,mprice:i,mcnt:1}),c(),u()}}function p(){e>0||(a=document.getElementById("mname").value,b=document.getElementById("mprice").value,a.length<0||a.length>10?alert("메뉴 이름 오류 (1~10자)"):(b<=0||isNaN(parseInt(b)))?alert("가격 오류"):(l(a,b),document.getElementById("mname").value="",document.getElementById("mprice").value=0))}function v(n){if(!(e>0)){if(t[n-1].mcnt-=1,0==t[n-1].mcnt){t.splice(n-1,1);for(var i=0;i<t.length;i++)t[i].id=i+1}c(),u()}}function f(n){e>0||(t[n-1].mcnt+=1,c(),u())}function h(){d("BUSY");var t=new XMLHttpRequest;t.onreadystatechange=function(){200==this.status&&this.readyState==this.DONE&&(g(JSON.parse(t.responseText)),d("STANDBY"));200!=this.status&&this.readyState==this.DONE&&d("STANDBY FAIL")},t.open("GET","/axhr/s/menu",!0),t.send()}function g(t){let e=[];for(const n of t)e.push(`\n        <div id="menu-i-${n.id}" class="menu-i" onclick="l('${n.mname}',${n.mprice})">\n            <div class="stxt">${n.mname}</div>\n            <div class="stxt">${n.mprice} ƕ</div>\n        </div>\n        `);document.getElementById("menu").innerHTML=e.join("")}a=function(){d("LOADING");try{var t="https://sacpay.ksaidev.com/scanner?sid="+o;bwipjs.toCanvas("qr",{bcid:"qrcode",text:t,scale:15})}catch(t){}s("SESSION:"+o);var e=new XMLHttpRequest;e.onreadystatechange=function(){if(200==this.status&&this.readyState==this.DONE){var t=JSON.parse(e.responseText);pname=t.name,d("STANDBY"),document.getElementById("program").innerHTML="현재 프로그램명: "+pname}},e.open("GET","/axhr/ai",!0),e.send()},c(),h();var y=!1,T=[];function B(){if((e-=1)<1)return e=0,r("시간초과"),d("STANDBY"),void(document.getElementById("pbtn").innerText="결제요청");r("대기중 "+e);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(200==this.status&&this.readyState==this.DONE){var i=JSON.parse(n.responseText);if("success"==i.result)return r("결제성공"),e=0,t=[],c(),u(),d("STANDBY"),void(document.getElementById("pbtn").innerText="결제요청");if(1==i.detail)return void setTimeout(B,1e3);if(2==i.detail)return r("QR만료"),e=0,d("STANDBY"),void(document.getElementById("pbtn").innerText="결제요청");if(3==i.detail)return r("잔액부족"),e=0,d("STANDBY"),void(document.getElementById("pbtn").innerText="결제요청");if(4==i.detail)return r("금액오류"),e=0,d("STANDBY"),void(document.getElementById("pbtn").innerText="결제요청")}200!=this.status&&this.readyState==this.DONE&&d("STANDBY FAIL")},n.open("POST","/axhr/s/tpay",!0);var i=new FormData;i.append("data",JSON.stringify(t)),n.send(i)}document.getElementById("pbtn").onclick=function(){if(!(e>0)){e=30,d("BUSY"),r("대기중 "+e),document.getElementById("pbtn").innerText="대기중";var t=new XMLHttpRequest;t.onreadystatechange=function(){if(200==this.status&&this.readyState==this.DONE){JSON.parse(t.responseText);d("WAIT")}200!=this.status&&this.readyState==this.DONE&&d("STANDBY FAIL")},t.open("GET","/axhr/s/tint",!0),t.send(),setTimeout(B,1e3)}},a();